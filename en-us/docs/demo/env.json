{
  "filename": "env.md",
  "__html": "<h1>尝试下简单的分布式事务</h1>\n<h2>步骤引导</h2>\n<ol>\n<li>准备依赖环境服务<br>\nJDK1.8+,Mysql5.6+,Redis3.2+,Consul(SpringCloud),ZooKeeper(Dubbo),Git,Maven</li>\n<li>初始化数据\n见下方说明</li>\n<li>启动TxManager(TM)<br>\n见下方说明</li>\n<li>配置微服务模块<br>\n见下方说明</li>\n<li>启动模块与测试<br>\n见下方说明</li>\n</ol>\n<h2>初始化数据</h2>\n<p>TM数据初始化<br>\nTxManager(TM)依赖tx-manager数据库(MariaDB 、MySQL)建表语句如下:</p>\n<pre><code class=\"language-$xslt\">DROP TABLE IF EXISTS `t_tx_exception`;\nCREATE TABLE `t_tx_exception`  (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `group_id` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,\n  `unit_id` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,\n  `mod_id` varchar(32) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,\n  `transaction_state` tinyint(4) NULL DEFAULT NULL,\n  `registrar` tinyint(4) NULL DEFAULT NULL COMMENT '-1 未知 0 Manager 通知事务失败， 1 client询问事务状态失败2 事务发起方关闭事务组失败',\n  `ex_state` tinyint(4) NULL DEFAULT NULL COMMENT '0 待处理 1已处理',\n  `create_time` datetime(0) NULL DEFAULT NULL,\n  PRIMARY KEY (`id`) USING BTREE\n) ENGINE = InnoDB AUTO_INCREMENT = 967 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_general_ci ROW_FORMAT = Dynamic;\n\n</code></pre>\n<p>TC数据初始化\n微服务演示Demo依赖txlcn-demo数据库(MariaDB 、MySQL)建表语句如下:</p>\n<pre><code class=\"language-$xslt\">DROP TABLE IF EXISTS `t_demo`;\nCREATE TABLE `t_demo` (\n  `id` bigint(20) NOT NULL AUTO_INCREMENT,\n  `kid` varchar(45) DEFAULT NULL,\n  `demo_field` varchar(255) DEFAULT NULL,\n  `group_id` varchar(64) DEFAULT NULL,\n  `unit_id` varchar(32) DEFAULT NULL,\n  `app_name` varchar(32) DEFAULT NULL,\n  `create_time` datetime DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;\n</code></pre>\n<h2>启动TxManager(TM)</h2>\n<h3>TM下载与配置</h3>\n<p><code>git clone https://github.com/codingapi/tx-lcn.git</code></p>\n<p>修改配置信息(txlcn-tm\\src\\main\\resources\\application.properties)</p>\n<pre><code>spring.application.name=tx-manager\nserver.port=7970\n\nspring.datasource.driver-class-name=com.mysql.jdbc.Driver\nspring.datasource.url=jdbc:mysql://127.0.0.1:3306/tx-manager?characterEncoding=UTF-8\nspring.datasource.username=root\nspring.datasource.password=root\n\nmybatis.configuration.map-underscore-to-camel-case=true\nmybatis.configuration.use-generated-keys=true\n\n#tx-lcn.logger.enabled=true\n# TxManager Host Ip\n#tx-lcn.manager.host=127.0.0.1\n# TxClient连接请求端口\n#tx-lcn.manager.port=8070\n# 心跳检测时间(ms)\n#tx-lcn.manager.heart-time=15000\n# 分布式事务执行总时间\n#tx-lcn.manager.dtx-time=30000\n#参数延迟删除时间单位ms\n#tx-lcn.message.netty.attr-delay-time=10000\n#tx-lcn.manager.concurrent-level=128\n# 开启日志\n#tx-lcn.logger.enabled=true\n#logging.level.com.codingapi=debug\n#redisIp\n#spring.redis.host=127.0.0.1\n#redis\\u7AEF\\u53E3\n#spring.redis.port=6379\n#redis\\u5BC6\\u7801\n#spring.redis.password=\n\n\n</code></pre>\n<ul>\n<li><code>#</code>给出信息都是默认值</li>\n</ul>\n<p>关于详细配置说明见 <a href=\"setting/manager.md\">manager</a></p>\n<h3>TM编译与启动</h3>\n<p>编译<br>\n进入到txlcn-tm路径下。 执行 <code>mvn clean package '-Dmaven.test.skip=true'</code><br>\n启动<br>\n进入target文件夹下。执行 <code>java -jar txlcn-tm-5.0.0.jar</code></p>\n<p>启动TxManager\n<img src=\"../../../img/docs/tx_manager.png\" alt=\"tx-manager\"></p>\n<h2>配置微服务模块</h2>\n<p>Dubbo Demo见<a href=\"dubbo.html\">Dubbo-Demo</a></p>\n<p>SpringCloud Demo见<a href=\"springcloud.html\">SpringCloud-Demo</a></p>\n<h2>启动模块与测试</h2>\n<p>（1）正常提交事务</p>\n<p>访问 发起方提供的Rest接口 <code>/txlcn?value=the-value</code>。发现事务全部提交<br>\n<img src=\"../../../img/docs/result.png\" alt=\"result\"></p>\n<p>（2）回滚事务</p>\n<p>修改微服务 发起方Client 业务，在返回结果前抛出异常，再请求Rest接口。发现发起方由于本地事务回滚，而参与方D、E，由于TX-LCN的协调，数据也回滚了。<br>\n<img src=\"../../../img/docs/error-result.png\" alt=\"error_result\"></p>\n",
  "link": "\\en-us\\docs\\demo\\env.html",
  "meta": {}
}