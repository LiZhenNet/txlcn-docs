{
  "filename": "start.md",
  "__html": "<h1>快速开始</h1>\n<h2>说明</h2>\n<p>TX-LCN 主要有两个模块，Tx-Client(TC) Tx-Manager(TM). TC作为微服务下的依赖，TM是独立的服务。<br>\n本教程带领大家了解框架的基本步骤，详细配置可参考 <a href=\"demo/dubbo.md\">dubbo</a> <a href=\"demo/springcloud.md\">springcloud</a></p>\n<h2>一、TM配置与启动</h2>\n<h3>TM的准备环境</h3>\n<ol>\n<li>安装TM需要依赖的中间件： JRE1.8+, Mysql5.6+, Redis3.2+</li>\n</ol>\n<blockquote>\n<p>如果需要手动编译源码， 还需要Git, Maven, JDK1.8+</p>\n</blockquote>\n<ol>\n<li>\n<p>创建MySQL数据库, 名称为: tx-manager</p>\n</li>\n<li>\n<p>创建数据表</p>\n</li>\n</ol>\n<pre><code class=\"language-sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-string\">`t_tx_exception`</span>  (\n  <span class=\"hljs-string\">`id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">20</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> AUTO_INCREMENT,\n  <span class=\"hljs-string\">`group_id`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">64</span>) <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`unit_id`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">32</span>) <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`mod_id`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">128</span>) <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`transaction_state`</span> <span class=\"hljs-built_in\">tinyint</span>(<span class=\"hljs-number\">4</span>) <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`registrar`</span> <span class=\"hljs-built_in\">tinyint</span>(<span class=\"hljs-number\">4</span>) <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`remark`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">4096</span>) <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span>  <span class=\"hljs-literal\">NULL</span>,\n  <span class=\"hljs-string\">`ex_state`</span> <span class=\"hljs-built_in\">tinyint</span>(<span class=\"hljs-number\">4</span>) <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'0 未解决 1已解决'</span>,\n  <span class=\"hljs-string\">`create_time`</span> datetime(<span class=\"hljs-number\">0</span>) <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span>,\n  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`id`</span>) <span class=\"hljs-keyword\">USING</span> BTREE\n) <span class=\"hljs-keyword\">ENGINE</span> = <span class=\"hljs-keyword\">InnoDB</span> AUTO_INCREMENT = <span class=\"hljs-number\">1</span> <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> = utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> = utf8mb4_general_ci ROW_FORMAT = Dynamic;\n</code></pre>\n<h3>TM下载与配置</h3>\n<ol>\n<li>\n<p>从<a href=\"https://bbs.txlcn.org/viewtopic.php?id=44\">历史版本TM下载</a>找到5.0.2.RELEASE的TM, 下载.</p>\n</li>\n<li>\n<p>修改配置信息</p>\n</li>\n</ol>\n<pre><code>spring.application.name=tx-manager\nserver.port=7970\n\nspring.datasource.driver-class-name=com.mysql.jdbc.Driver\nspring.datasource.url=jdbc:mysql://127.0.0.1:3306/tx-manager?characterEncoding=UTF-8\nspring.datasource.username=root\nspring.datasource.password=root\n\nmybatis.configuration.map-underscore-to-camel-case=true\nmybatis.configuration.use-generated-keys=true\n\n#tx-lcn.logger.enabled=true\n# TxManager Host Ip\n#tx-lcn.manager.host=127.0.0.1\n# TxClient连接请求端口\n#tx-lcn.manager.port=8070\n# 心跳检测时间(ms)\n#tx-lcn.manager.heart-time=15000\n# 分布式事务执行总时间\n#tx-lcn.manager.dtx-time=30000\n#参数延迟删除时间单位ms\n#tx-lcn.message.netty.attr-delay-time=10000\n#tx-lcn.manager.concurrent-level=128\n# 开启日志\n#tx-lcn.logger.enabled=true\n#logging.level.com.codingapi=debug\n#redis 主机\n#spring.redis.host=127.0.0.1\n#redis 端口\n#spring.redis.port=6379\n#redis 密码\n#spring.redis.password=\n</code></pre>\n<ul>\n<li>\n<p><code>#</code> 给出信息都是默认值<br>\n关于详细配置说明见<a href=\"setting/manager.md\">TM配置</a></p>\n</li>\n<li>\n<p>application.properties 加载顺序如下：<br>\n0、命令行启动参数指定<br>\n1、file:./config/（当前jar目录下的config目录）<br>\n2、file:./（当前jar目录）<br>\n3、classpath:/config/（classpath下的config目录）<br>\n4、classpath:/（classpath根目录）<br>\n发布的二进制可执行Jar包含一个默认配置文件（也就是4），可按需要覆盖默认配置</p>\n</li>\n<li>\n<p>手动编译TM，简单指引</p>\n</li>\n</ul>\n<pre><code># git clone https://github.com/codingapi/tx-lcn.git &amp; cd txlcn-tm\n# mvn clean  package '-Dmaven.test.skip=true'\n</code></pre>\n<p>target文件夹下，即为TM executable jar.</p>\n<h2>二、TC微服务模块</h2>\n<p>微服务示例架构</p>\n<p><img src=\"../../img/quick_arch.png\" alt=\"arch\"></p>\n<ul>\n<li>服务A作为DTX发起方，远程调用服务B</li>\n</ul>\n<h3>TC引入pom依赖</h3>\n<pre><code class=\"language-xml\">        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.codingapi.txlcn<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>txlcn-tc<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.0.2.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.codingapi.txlcn<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>txlcn-txmsg-netty<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>\n            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.0.2.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>\n</code></pre>\n<h3>TC开启分布式事务注解</h3>\n<p>在主类上使用<code>@EnableDistributedTransaction</code></p>\n<pre><code class=\"language-java\"><span class=\"hljs-meta\">@SpringBootApplication</span>\n<span class=\"hljs-meta\">@EnableDistributedTransaction</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DemoAApplication</span> </span>{\n\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>{\n        SpringApplication.run(DemoDubboClientApplication.class, args);\n    }\n\n}\n</code></pre>\n<h3>TC微服务A业务方法配置</h3>\n<pre><code class=\"language-java\"><span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ServiceA</span> </span>{\n    \n    <span class=\"hljs-meta\">@Autowired</span>\n    <span class=\"hljs-keyword\">private</span> ValueDao valueDao; <span class=\"hljs-comment\">//本地db操作</span>\n    \n    <span class=\"hljs-meta\">@Autowired</span>\n    <span class=\"hljs-keyword\">private</span> ServiceB serviceB;<span class=\"hljs-comment\">//远程B模块业务</span>\n    \n    <span class=\"hljs-meta\">@LcnTransaction</span> <span class=\"hljs-comment\">//分布式事务注解</span>\n    <span class=\"hljs-meta\">@Transactional</span> <span class=\"hljs-comment\">//本地事务注解</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">execute</span><span class=\"hljs-params\">(String value)</span> <span class=\"hljs-keyword\">throws</span> BusinessException </span>{\n        <span class=\"hljs-comment\">// step1. call remote service B</span>\n        String result = serviceB.rpc(value);  <span class=\"hljs-comment\">// (1)</span>\n        <span class=\"hljs-comment\">// step2. local store operate. DTX commit if save success, rollback if not.</span>\n        valueDao.save(value);  <span class=\"hljs-comment\">// (2)</span>\n        valueDao.saveBackup(value);  <span class=\"hljs-comment\">// (3)</span>\n        <span class=\"hljs-keyword\">return</span> result + <span class=\"hljs-string\">\" &gt; \"</span> + <span class=\"hljs-string\">\"ok-A\"</span>;\n    }\n}\n</code></pre>\n<h3>TC微服务B业务方法配置</h3>\n<pre><code class=\"language-java\"><span class=\"hljs-meta\">@Service</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ServiceB</span> </span>{\n    \n    <span class=\"hljs-meta\">@Autowired</span>\n    <span class=\"hljs-keyword\">private</span> ValueDao valueDao; <span class=\"hljs-comment\">//本地db操作</span>\n    \n    <span class=\"hljs-meta\">@LcnTransaction</span> <span class=\"hljs-comment\">//分布式事务注解</span>\n    <span class=\"hljs-meta\">@Transactional</span>  <span class=\"hljs-comment\">//本地事务注解</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">rpc</span><span class=\"hljs-params\">(String value)</span> <span class=\"hljs-keyword\">throws</span> BusinessException </span>{\n        valueDao.save(value);  <span class=\"hljs-comment\">// (4)</span>\n        valueDao.saveBackup(value);  <span class=\"hljs-comment\">// (5)</span>\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"ok-B\"</span>;\n    }\n}\n</code></pre>\n<h3>TC配置信息说明</h3>\n<pre><code># 默认之配置为TM的本机默认端口\ntx-lcn.client.manager-address=127.0.0.1:8070 \n</code></pre>\n",
  "link": "\\zh-cn\\docs\\start.html",
  "meta": {}
}